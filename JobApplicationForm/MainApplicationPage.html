<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset=UTF-8>
        <title>Oplog Application</title>
    </head>
    <style>
        div.mainDiv{
            height:fit-content;
            display:flex;
        }
        div.mainDiv >  div{
            flex: 1; 
        }
        #divCenter{
            
            display:grid;
            align-content: center;
            
        }

     </style>
    
    <body style="background-color: rgb(189, 189, 189);">
                      
        
        <div class="center" style="border: 4px solid rgb(56, 169, 235);margin-bottom: 0.3cm;">
            <h1><b>Oplog Job Application Form</b></h1>
        </div>
        
        <div class="mainDiv">
            <div id="divPersonalInfo" style="border: 4px solid rgb(56, 169, 235);margin: 0.2cm;padding:0.3cm;">
                
                <h2><b>Personal Information:</b></h2>
                <form>
                
                    <label style="font-size:x-large;">First Name:</label><br>
                    <input type="text" id="FName" ><br>
                    <br>
                    <label style="font-size:x-large">Last Name:</label><br>
                    <input type="text" id="LName"><br>
                    <br>
                    <label style="font-size: x-large;">Birthdate:</label><br>
                    <input type="date" id="BDate">
                
                </form>
            </div>

            <div class="center" id="divExperience" style="border: 4px solid rgb(56, 169, 235);margin: 0.2cm;padding:0.3cm;" >
                
                <h2><b>Experiences</b></h2>

                <form id="frmExperience" >
                
                    <label style="font-size:x-large;">Company Name:</label><br>
                    <input type="text" id="CompanyName_0"><br>
                    
                    <br>
                    <label style="font-size:x-large">Start Year:</label><br>
                    <input type="number" id="StartYear_0"><br>                  
                     
                    <br>
                    <label style="font-size: x-large;">End Year:</label>
                    <input type="number" id="EndYear_0">
                    <br>
                    
                    <label>Still working?</label>
                    <!-- <button id="btnStillWorking" onclick="inputStillWorking()">Yes</button>
                    <br> -->
                    <!--<input type="submit">-->
                </form>
                <button id="btnStillWorking" onclick="inputStillWorking()">Yes</button>
                    <br>
                
                <br>
                <!--<button id="btnAdd" onclick="addExperience()"><b>Add new experience</b></button>-->

            </div>
            <div id="divExpectations" style="border: 4px solid rgb(56, 169, 235);margin: 0.2cm;width:fit-content;padding:0.3cm;">
                
                <h2><b>Expectations:</b></h2>
                <form>
                    <label style="font-size:x-large;">Salary:</label><br>
                    <input type="number" id="Salary"><br>
                    <br>
                    <label style="font-size:x-large">Additional:</label><br>
                    <textarea id="AdditionalExp"></textarea>
                    <br>
                
                </form>
            </div>


            
        
        </div>
        <div id="divCenter" >
            <button id="btnAdd" onclick="addExperience()" style="font-size: x-large;"><b>Add new experience</b></button>
            <button id="btnSubmit" style="font-size: xx-large;" onclick="sendData()">SUBMIT</button>
        </div>
        
        <script>
                    
            function inputStillWorking(){
                var test = document.getElementById("EndYear");
                document.getElementById("EndYear_0").disabled = true;
                
            }
            
            function addExperience(){
                var currentFormCount = document.querySelectorAll("#divExperience form").length; //Current forms:1
                var nextIndex = currentFormCount; // nextIndex = 1

                var divNewExperience = document.createElement("div");
                var frmNewExperience = document.createElement("form");
                var brExperience = document.createElement("br");
                
                var lblCompanyName = document.createElement("label");
                    lblCompanyName.innerText = "Company Name:";
                    lblCompanyName.style.fontSize = "x-large";
                    lblCompanyName.append(brExperience);
                
                

                var lblStartYear = document.createElement("label");
                    lblStartYear.innerText =  "Start Year:";
                    lblStartYear.style.fontSize = "x-large";
                    lblStartYear.append(brExperience);
                
                var lblEndYear = document.createElement("label");
                    lblEndYear.id = "lblEndYear";
                    lblEndYear.innerText = "End Year:"
                    lblEndYear.style.fontSize = "x-large";
                    lblEndYear.append(brExperience);

                var lblStillWorking = document.createElement("label");
                    lblStillWorking.innerText = "Still Working?"                
                    lblStillWorking.append(brExperience);

                var inpCompanyName = document.createElement("input");
                    inpCompanyName.id = "CompanyName_" + nextIndex; // CompanyName_1
                    inpCompanyName.type = "text";
                    inpCompanyName.append(brExperience);
                
                var inpStartYear = document.createElement("input");
                    inpStartYear.id = "StartYear_" + nextIndex;
                    inpStartYear.type = "number";
                    inpStartYear.append(brExperience);
                
                var inpEndYear = document.createElement("input");
                    inpEndYear.id = "EndYear_" + nextIndex;
                    inpEndYear.type = "number";
                    inpEndYear.append(brExperience);

                //var inpSubmit = document.createElement("input");
                //    inpSubmit.append(brExperience);

                // var btnNewStillWorking = document.createElement("button");
                //     btnNewStillWorking.innerText="Yes";
                //     btnNewStillWorking.onclick = function(){
                //        lblEndYear.disabled = true;
                //     }
                    
                
                
                frmNewExperience.append(lblCompanyName);
                //frmNewExperience.append(brExperience);
                frmNewExperience.append(inpCompanyName);
                //frmNewExperience.append(brExperience);
                frmNewExperience.append(lblStartYear);
                //frmNewExperience.append(brExperience);
                frmNewExperience.append(inpStartYear);
                //frmNewExperience.append(brExperience);
                frmNewExperience.append(lblEndYear);

                var btnNewStillWorking = document.createElement("button");
                    btnNewStillWorking.innerText="Yes";
                    btnNewStillWorking.onclick = function(){
                       inpEndYear.disabled = true;
                    }
                
                
                    //frmNewExperience.append(brExperience);
                frmNewExperience.append(inpEndYear);
                //frmNewExperience.append(brExperience);
                frmNewExperience.append(lblStillWorking);
               
                //frmNewExperience.append(inpSubmit);
                
                divNewExperience.append(frmNewExperience);
                divNewExperience.append(btnNewStillWorking);
                

                var divNewExperience2 = document.getElementById("divExperience");
                
                divNewExperience2.append(divNewExperience);
                //document.getElementById("divExperience").append(divNewExperience);
                //document.getElementById("btnAdd").append(btnAddExp);
                
                
            }
            function sendData(){ //nextIndex = 1 ---> nextIndex = 2
                var currentFormCount = document.querySelectorAll("#divExperience form").length; //Current forms:1
                
                var nextIndex = currentFormCount-1; // nextIndex = 1
                
                var FName = document.getElementById("FName").value;
                var LName = document.getElementById("LName").value;
                var bDate = document.getElementById("BDate").value;
                var BDate = new Date(Date.parse(bDate));
                
                var Salary = document.getElementById("Salary").value;
                Salary = parseFloat(Salary);
                var AdditionalExp = document.getElementById("AdditionalExp").value;
                var userData = {
                    PersonalInfo:{
                        FName:FName,
                        LName:LName,
                        BDate:BDate
                    },
                    Experiences:[],
                    Expectations:{
                        Salary:Salary,
                        AdditionalExp:AdditionalExp
                    },
                    UserId: 1
                }

                console.log(nextIndex);
                for(i = 0; i<=nextIndex/*2*/; i++){
                    //var CompanyName = document.getElementById("CompanyName_"+nextIndex); //CompanyName_1 ---> CompanyName_2
                   
                    console.log(document.getElementById("CompanyName_0"));
                    console.log(i);
                    var CompanyName = document.getElementById("CompanyName_"+i).value;
                    var StartYear = document.getElementById("StartYear_"+i).value;
                    StartYear = parseFloat(StartYear);
                    var EndYear = document.getElementById("EndYear_"+i).value;
                    EndYear = parseFloat(EndYear);
                    
                    userData.Experiences.push({
                        CompanyName:CompanyName, 
                        StartYear:StartYear, 
                        EndYear:EndYear})
                }
                console.log(userData);
                const options ={
                        method:"POST",
                        headers:{
                            "content-type":"application/json; charset=UTF-8"
                        },
                        body:JSON.stringify(userData)
                    };
                fetch("http://localhost:5000/api/post",options)
                    .then(response => response.json())
                    .then(response => console.log(response))
                    .catch(e => console.log(e))

                
                // var bDate = document.getElementById("BDate").value;
                // var BDate = new Date(Date.parse(bDate));
                // console.log(Date(Date.parse("2020-12-1")));
                // var FName = document.getElementById("FName").value;
                // var LName = document.getElementById("LName").value;
                // var CompanyName = document.getElementById("CompanyName_0").value;
                // var StartYear = document.getElementById("StartYear_0").value;
                // var EndYear = document.getElementById("EndYear_0").value;
                // var Salary = document.getElementById("Salary").value;
                // var AdditionalExp = document.getElementById("AdditionalExp").value;

                // var data = {
                //     FirstName:FName,
                //     LastName:LName,
                //     BirthDate:BDate,
                //     CompanyName:CompanyName,
                //     StartYear:StartYear,
                //     EndYear:EndYear,
                //     Salary:Salary,
                //     AdditionalExpectations:AdditionalExp
                // }
                // console.log(data);
                // const options ={
                //     method:"POST",
                //     headers:{
                //         "content-type":"application/json; charset=UTF-8"
                //     },
                //     body:JSON.stringify(data)
                // };

                // fetch("http://localhost:5000/api/post",options)
                // .then(response => response.json())
                // .then(response => console.log(response))
                // .catch(e => console.log(e))

            }

            
            
        </script>
       
        
    </body>
   
</html>